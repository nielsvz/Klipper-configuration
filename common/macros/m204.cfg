[gcode_macro M204]
description: Override the default M204 command and properly set accel and accel_to_decel
rename_existing: M204.1
gcode:
  {% set P = params.P | default (0.0) | float %}
  {% set S = params.S | default (0.0) | float %}
  {% set T = params.T | default (0.0) | float %}

  {% set accel = [P, S, T] | max %}

  {% if accel > 0.0 %}
    SET_VELOCITY_LIMIT ACCEL={ accel } ACCEL_TO_DECEL={ accel / 2.0 }
  {% endif %}